import json
import os
import re
from typing import List, Dict, Any
import ollama  # –ò–ª–∏ openai, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ OpenAI API


class JsonFileTaggingAgent:
    def __init__(self, model_name: str, tags_list: List[str] = None):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–≤–æ–Ω–∫–æ–≤

        Args:
            model_name: –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Ollama
            tags_list: —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
        """
        self.client = ollama.Client()
        self.model_name = model_name

        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ–≥–∏ (—Ä–∞—Å—à–∏—Ä—å—Ç–µ –ø–æ–¥ —Å–≤–æ—é –ø—Ä–µ–¥–º–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å)
        self.tags_list = tags_list

        # –ö—ç—à –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        self.processed_files = set()

    def process_directory(self, input_dir: str, output_dir: str = None):
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö JSON —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

        Args:
            input_dir: –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å JSON —Ñ–∞–π–ª–∞–º–∏
            output_dir: –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ None, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ)
        """
        if output_dir and not os.path.exists(output_dir):
            os.makedirs(output_dir)

        json_files = [f for f in os.listdir(input_dir) if f.endswith('.json')]
        print(f"üìÅ –ù–∞–π–¥–µ–Ω–æ {len(json_files)} JSON —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")

        for i, filename in enumerate(json_files, 1):
            if i < 137:
                continue
            print(f"\n[{i}/{len(json_files)}] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é {filename}...")

            input_path = os.path.join(input_dir, filename)
            output_path = os.path.join(output_dir, filename) if output_dir else input_path

            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ
            if filename in self.processed_files:
                print(f"   ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω)")
                continue

            try:
                result = self.tag_single_file(input_path, output_path)
                if result:
                    self.processed_files.add(filename)
                    print(f"   ‚úÖ –£—Å–ø–µ—à–Ω–æ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω. –¢–µ–≥–∏: {result.get('tags', [])}")
            except Exception as e:
                print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")

    def tag_single_file(self, input_path: str, output_path: str) -> Dict[str, Any]:
        """
        –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ JSON —Ñ–∞–π–ª–∞

        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        """
        # –ó–∞–≥—Ä—É–∑–∫–∞ JSON
        with open(input_path, 'r', encoding='utf-8') as f:
            data = json.load(f)

        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        if 'transcription' in data and 'text' in data['transcription']:
            text = data['transcription']['text']
        elif 'text' in data:
            text = data['text']
        else:
            raise ValueError(f"–í —Ñ–∞–π–ª–µ {input_path} –Ω–µ –Ω–∞–π–¥–µ–Ω —Ç–µ–∫—Å—Ç –∑–≤–æ–Ω–∫–∞")

        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –æ—Ç LLM
        tags_result = self.get_tags_from_llm(text)

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
        if 'tags' not in data:
            data['tags'] = {}

        data['tags']['auto_generated'] = tags_result.get('result', [])
        data['tags']['additional_suggested'] = tags_result.get('additional_tags', [])
        data['tags']['llm_reasoning'] = tags_result.get('reasoning', '')
        data['tags']['processing_model'] = self.model_name

        data.pop('segments', None)

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ JSON
        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

        return tags_result

    def get_tags_from_llm(self, text: str) -> Dict[str, Any]:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –æ—Ç LLM —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π

        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏
        """
        # –£—Ä–µ–∑–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—É—Ç—å)
        truncated_text = text[:3000] + "..." if len(text) > 3000 else text

        # –°—Ç—Ä–æ–≥–∏–π –ø—Ä–æ–º–ø—Ç —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º JSON —Ñ–æ—Ä–º–∞—Ç–∞
        prompt = f"""–¢—ã ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.
–ï—Å—Ç—å –∑–∞–ø–∏—Å–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–º —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–µ—Ä—É—Ç –≤ –∞—Ä–µ–Ω–¥—É –∫–æ–≤—Ä—ã –∏ –ø–æ–ª—É—á–∞—é—Ç —É—Å–ª—É–≥–∏ –ø–æ –∏—Ö –∑–∞–º–µ–Ω–µ –∏ —á–∏—Å—Ç–∫–µ.

–í–æ—Ç —Ç–µ–∫—Å—Ç –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞:
{truncated_text}

–¢–í–û–ï –ó–ê–î–ê–ù–ò–ï: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –≤ –æ–¥–Ω–æ–º-–¥–≤—É—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –æ–ø–∏—à–∏ –ø—Ä–∏—á–∏–Ω—É, –ø–æ—á–µ–º—É –ø–æ–∑–≤–æ–Ω–∏–ª –∫–ª–∏–µ–Ω—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä:
"–∫–æ–≤—Ä—ã –Ω–µ –¥–æ—Å—Ç–∞–≤–∏–ª–∏ –≤–æ–≤—Ä–µ–º—è", "–∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –∫–æ–≤—Ä–æ–≤", "–∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –¥–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ", "–∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞",
"–∫–ª–∏–µ–Ω—Ç —Ä–∞–Ω–µ–µ —É–∂–µ –ø–æ–ª—É—á–∞–ª —É—Å–ª—É–≥–∏ –∏ —Ö–æ—á–µ—Ç –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å", "—ç—Ç–æ –Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç, –æ–Ω —Ö–æ—á–µ—Ç –∑–∞–∫–ª—é—á–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä", "–∫–æ–≤—Ä—ã –ø–ª–æ—Ö–æ –ø–æ—á–∏—Å—Ç–∏–ª–∏",
"–∫–æ–≤—Ä—ã –Ω–µ –∑–∞–º–µ–Ω–∏–ª–∏ –≤–æ–≤—Ä–µ–º—è", "–Ω–µ –≤—ã—Å—Ç–∞–≤–∏–ª–∏ —Å—á–µ—Ç –∑–∞ —É—Å–ª—É–≥–∏", "—Å—á–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ", "–º–µ–Ω–µ–¥–∂–µ—Ä –∏–≤–∞–Ω–æ–≤ –æ–±–µ—â–∞–ª –ø–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å, –Ω–æ –Ω–µ –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–ª",
"—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç", "–∫–æ–≤—Ä—ã –Ω–µ –º–µ–Ω—è–ª–∏ –≤–æ–≤—Ä–µ–º—è", "–∫–æ–≤—Ä—ã –∑–∞–º–µ–Ω—è—é—Ç —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ", "–∫–ª–∏–µ–Ω—Ç –Ω–µ–¥–æ–≤–æ–ª–µ–Ω –Ω–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω—ã–º –ø–æ–≤—ã—à–µ–Ω–∏–µ–º —Ü–µ–Ω", "–∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞—è–≤–∫—É", –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–µ.
–ï—Å–ª–∏ —É –∑–≤–æ–Ω–∫–∞ –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã, –Ω–∞–ø–∏—à–∏ –ø–µ—Ä–≤—ã–µ –¥–≤–µ –ø—Ä–∏—á–∏–Ω—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ü—Ä–∏—á–∏–Ω–∞ –ù–ï –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∞ —Å–ª–∏—à–∫–æ–º –æ–±—â–æ, –∏ –¥–æ–ª–∂–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é.
–í–ï–†–ù–ò –û–¢–í–ï–¢ –¢–û–õ–¨–ö–û –í –§–û–†–ú–ê–¢–ï JSON:
{{
  "result": ["reason1", "reason2"],
}}
–ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —è—Å–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã –æ–±—Ä–∞—â–µ–Ω–∏—è - –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
"""

        try:
            response = self.client.generate(
                model=self.model_name,
                prompt=prompt,
                format="json",  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞!
                options={
                    'temperature': 0.3,  # –ú–∏–Ω–∏–º—É–º –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
                    'num_predict': 150,
                    'top_p': 0.9
                }
            )

            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
            response_text = response['response']

            # –ò—â–µ–º JSON –≤ –æ—Ç–≤–µ—Ç–µ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –¥–æ–±–∞–≤–∏–ª–∞ —Ç–µ–∫—Å—Ç)
            json_match = re.search(r'\{.*\}', response_text, re.DOTALL)
            if json_match:
                result = json.loads(json_match.group())

                # –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞
                valid_selected = []
                for tag in result.get('result', []):
                    #if tag in self.tags_list:
                    valid_selected.append(tag)
                    #else:
                    #    print(f"   ‚ö†Ô∏è  –ú–æ–¥–µ–ª—å –ø—Ä–∏–¥—É–º–∞–ª–∞ —Ç–µ–≥ '{tag}', –∏–≥–Ω–æ—Ä–∏—Ä—É—é")

                result['result'] = valid_selected

                return result
            else:
                raise ValueError("LLM –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ JSON")

        except Exception as e:
            print(f"   ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ LLM: {e}")
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            return {
                "result": [],
                "additional_tags": [],
                "reasoning": f"–û—à–∏–±–∫–∞: {str(e)}"
            }

    def validate_tags_consistency(self, input_dir: str, sample_size: int = 20):
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç—Ä–æ–ª—è)

        Args:
            input_dir: –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
            sample_size: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        """
        print("\n" + "=" * 60)
        print("üîç –ü–†–û–í–ï–†–ö–ê –ö–û–ù–°–ò–°–¢–ï–ù–¢–ù–û–°–¢–ò –¢–ï–ì–ò–†–û–í–ê–ù–ò–Ø")
        print("=" * 60)

        json_files = [f for f in os.listdir(input_dir) if f.endswith('.json')]
        sample_files = json_files[:min(sample_size, len(json_files))]

        tag_counts = {}
        additional_counts = {}

        for filename in sample_files:
            with open(os.path.join(input_dir, filename), 'r', encoding='utf-8') as f:
                data = json.load(f)

            if 'tags' in data and 'auto_generated' in data['tags']:
                for tag in data['tags']['auto_generated']:
                    tag_counts[tag] = tag_counts.get(tag, 0) + 1

                for tag in data['tags'].get('additional_suggested', []):
                    additional_counts[tag] = additional_counts.get(tag, 0) + 1

        print("\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –¢–ï–ì–û–í (–≤—ã–±–æ—Ä–∫–∞):")
        for tag, count in sorted(tag_counts.items(), key=lambda x: x[1], reverse=True):
            print(f"   {tag}: {count}")

        if additional_counts:
            print("\nüí° –ü–†–ï–î–õ–û–ñ–ï–ù–ù–´–ï –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–ï–ì–ò:")
            for tag, count in sorted(additional_counts.items(), key=lambda x: x[1], reverse=True):
                print(f"   '{tag}': {count}")

        print(f"\n‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: {len(sample_files)}")
        print(f"‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤: {len(tag_counts)}")


# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
def main():
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞ —Å –≤–∞—à–∏–º —Å–ø–∏—Å–∫–æ–º —Ç–µ–≥–æ–≤
    my_tags = [
        # complaints
        "—Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ —Ü–µ–Ω—ã",
        "–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è",
        "–≥—Ä—è–∑–Ω—ã–π –∫–æ–≤–µ—Ä –∏–ª–∏ –ø–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —á–∏—Å—Ç–∫–∏",
        #"–ø—Ä–µ—Ç–µ–Ω–∑–∏—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É",
        "–∂–∞–ª–æ–±–∞ –Ω–∞ —Ö–∞–º—Å—Ç–≤–æ –∏–ª–∏ –≥—Ä—É–±–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—è",
        "–¥–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∏—à–Ω–∏–µ –∫–æ–≤—Ä—ã, –ª–∏—à–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞",
        "—É–≤–µ–∑–ª–∏ –∫–æ–≤–µ—Ä –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã –∏–ª–∏ —Ä–∞–Ω—å—à–µ —Å—Ä–æ–∫–∞",
        "–∫–æ–≤–µ—Ä –∑–∞–±—Ä–∞–ª–∏ –ø–æ–∑–∂–µ —Å—Ä–æ–∫–∞",
        "–Ω–µ –¥–æ—Å—Ç–∞–≤–∏–ª–∏ –∫–æ–≤—Ä—ã –≤ —Å—Ä–æ–∫",
        "–¥–æ–ª–≥–æ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞—è–≤–∫—É",
        "–Ω–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ",
        "–Ω–µ–≤–µ—Ä–Ω–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω —Å—á–µ—Ç",
        "–æ—à–∏–±–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö",

        # questions
        "–∫–ª–∏–µ–Ω—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç",
        #"–≤–æ–ø—Ä–æ—Å –ø–æ –æ–ø–ª–∞—Ç–µ",
        "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∏–ª–∏ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π",
        "–¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–≤—Ä–æ–≤",
        "—É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–≤—Ä–æ–≤, –∏–ª–∏ –Ω—É–∂–Ω–æ –º–µ–Ω—å—à–µ –∫–æ–≤—Ä–æ–≤",
        "–∑–∞–ø—Ä–æ—Å —Å—á–µ—Ç–∞, –∏–ª–∏ –Ω–µ –≤—ã—Å—Ç–∞–≤–∏–ª–∏ –≤–æ–≤—Ä–µ–º—è —Å—á–µ—Ç",
        "–Ω–µ –≤—ã—Å—Ç–∞–≤–∏–ª–∏ –≤–æ–≤—Ä–µ–º—è",
        "–Ω–µ –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–ª–∏",
        #"–≤–æ–ø—Ä–æ—Å –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º",
        #"–¥—Ä—É–≥–∏–µ –ø—Ä–æ—Å—å–±—ã",

        # problems
        #"–∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –æ–ø–ª–∞—Ç–∏—Ç—å –≤–æ–≤—Ä–µ–º—è",

        # contracts and conditions
        "–Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç: –∑–∞–∫–ª—é—á–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä, –Ω–∞—á–∞—Ç—å —É—Å–ª—É–≥–∏",
        "–∏–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞/–¥–æ–≥–æ–≤–æ—Ä–∞",
        "–ø–µ—Ä–µ–∑–∞–∫–ª—é—á–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä",
        #"–ø—Ä–æ—Å—å–±–∞ –≤–º–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–∫–∞–∑",
        #"–ø—Ä–æ—Å—å–±–∞ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏",
        "–≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥",
        #"–∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç —É–π—Ç–∏ –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º",
        "—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞"
        
        # emotions
        # "–∫–ª–∏–µ–Ω—Ç –≥—Ä—É–±–∏—Ç –º–µ–Ω–µ–¥–∂–µ—Ä—É",
        # "–º–µ–Ω–µ–¥–∂–µ—Ä –≥—Ä—É–±–∏—Ç –∫–ª–∏–µ–Ω—Ç—É",
        # "–∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –≤—ã—Ä–∞–∑–∏—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å"
    ]

    tagger = JsonFileTaggingAgent(
        model_name="mistral-nemo:12b",  # –∏–ª–∏ "mistral", "qwen2.5:7b" –∏ —Ç.–¥.
        tags_list=my_tags
    )

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    input_directory = "transcriptions/"
    output_directory = "transcriptions_with_tags_mistral-nemo12/"  # –∏–ª–∏ None –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

    # –û—Å–Ω–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    tagger.process_directory(input_directory, output_directory)

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    result_dir = output_directory or input_directory
    tagger.validate_tags_consistency(result_dir)

    print("\n" + "=" * 60)
    print("üéâ –¢–ï–ì–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!")
    print("=" * 60)


if __name__ == "__main__":
    main()